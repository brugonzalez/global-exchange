{% extends 'base.html' %}
{% load formateo_divisas %}

{% block title %}Eliminar Moneda {{ object.codigo }} - Global Exchange{% endblock %}

{% block content %}
<div class="container my-4">
    <!-- Encabezado -->
    <div class="row mb-4">
        <div class="col">
            <h2 class="text-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {% if puede_eliminarse %}
                    Eliminar Moneda: {{ object.codigo }} - {{ object.nombre }}
                {% else %}
                    Deshabilitar Moneda: {{ object.codigo }} - {{ object.nombre }}
                {% endif %}
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'divisas:panel_de_control' %}">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'divisas:gestionar_monedas' %}">Gestión de Monedas</a></li>
                    <li class="breadcrumb-item active">
                        {% if puede_eliminarse %}Eliminar{% else %}Deshabilitar{% endif %} {{ object.codigo }}
                    </li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header {% if puede_eliminarse %}bg-danger text-white{% else %}bg-warning{% endif %}">
                    <h5 class="mb-0">
                        <i class="fas fa-{% if puede_eliminarse %}trash{% else %}ban{% endif %} me-2"></i>
                        {% if puede_eliminarse %}
                            Confirmar Eliminación
                        {% else %}
                            Confirmar Deshabilitación
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    {% if object.es_moneda_base %}
                        <!-- Moneda base no puede eliminarse -->
                        <div class="alert alert-danger">
                            <h5><i class="fas fa-ban me-2"></i>No se puede eliminar</h5>
                            <p>Esta es la <strong>moneda base</strong> del sistema y no puede ser eliminada.</p>
                            <p>La moneda base es fundamental para el funcionamiento del sistema de cambio.</p>
                        </div>
                        <div class="d-flex justify-content-center">
                            <a href="{% url 'divisas:gestionar_monedas' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Volver a la Lista
                            </a>
                        </div>
                    {% elif puede_eliminarse %}
                        <!-- Puede eliminarse completamente -->
                        <div class="alert alert-warning">
                            <h5><i class="fas fa-exclamation-triangle me-2"></i>¿Está seguro?</h5>
                            <p>Esta acción <strong>eliminará permanentemente</strong> la moneda <strong>{{ object.codigo }} - {{ object.nombre }}</strong>.</p>
                            <p>Esta acción <strong>no se puede deshacer</strong>.</p>
                        </div>

                        <!-- Información de la moneda -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6>Información de la Moneda:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Código:</strong> {{ object.codigo }}</li>
                                    <li><strong>Nombre:</strong> {{ object.nombre }}</li>
                                    <li><strong>Símbolo:</strong> {{ object.simbolo }}</li>
                                    <li><strong>Estado:</strong> 
                                        {% if object.esta_activa %}
                                            <span class="badge bg-success">Activa</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactiva</span>
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Configuración:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Decimales:</strong> {{ object.lugares_decimales }}</li>
                                    <li><strong>Disponible para compra:</strong> 
                                        {% if object.disponible_para_compra %}Sí{% else %}No{% endif %}
                                    </li>
                                    <li><strong>Disponible para venta:</strong> 
                                        {% if object.disponible_para_venta %}Sí{% else %}No{% endif %}
                                    </li>
                                    <li><strong>Fecha creación:</strong> {{ object.fecha_creacion|date:"d/m/Y H:i" }}</li>
                                </ul>
                            </div>
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            <div class="d-flex justify-content-between">
                                <a href="{% url 'divisas:gestionar_monedas' %}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-1"></i>Volver
                                </a>
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-trash me-1"></i>Sí, Eliminar Permanentemente
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <!-- No puede eliminarse, solo deshabilitar -->
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>No se puede eliminar</h5>
                            <p>La moneda <strong>{{ object.codigo }} - {{ object.nombre }}</strong> tiene transacciones asociadas y no puede ser eliminada permanentemente.</p>
                            <p>En su lugar, se <strong>deshabilitará temporalmente</strong>:</p>
                            <ul>
                                <li>Se marcará como inactiva</li>
                                <li>Se deshabilitará para compra y venta</li>
                                <li>Se conservará su historial de transacciones</li>
                                <li>Podrá reactivarse en el futuro si es necesario</li>
                            </ul>
                        </div>

                        <!-- Información de la moneda -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6>Información de la Moneda:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Código:</strong> {{ object.codigo }}</li>
                                    <li><strong>Nombre:</strong> {{ object.nombre }}</li>
                                    <li><strong>Símbolo:</strong> {{ object.simbolo }}</li>
                                    <li><strong>Estado actual:</strong> 
                                        {% if object.esta_activa %}
                                            <span class="badge bg-success">Activa</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactiva</span>
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Estadísticas de Uso:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Total transacciones:</strong> {{ stats.total_transacciones }}</li>
                                    <li><strong>Monto origen:</strong> {{ stats.monto_total_origen|floatformat:2 }}</li>
                                    <li><strong>Monto destino:</strong> {{ stats.monto_total_destino|floatformat:2 }}</li>
                                    <li><strong>Fecha creación:</strong> {{ object.fecha_creacion|date:"d/m/Y H:i" }}</li>
                                </ul>
                            </div>
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            <div class="d-flex justify-content-between">
                                <a href="{% url 'divisas:gestionar_monedas' %}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-1"></i>Volver
                                </a>
                                <button type="submit" class="btn btn-warning">
                                    <i class="fas fa-ban me-1"></i>Sí, Deshabilitar Temporalmente
                                </button>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Panel de información -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-1"></i>
                        Información Importante
                    </h6>
                </div>
                <div class="card-body">
                    {% if puede_eliminarse %}
                        <h6 class="text-danger">Eliminación Permanente</h6>
                        <ul class="small">
                            <li>La moneda será eliminada completamente del sistema</li>
                            <li>No tiene transacciones asociadas</li>
                            <li>Esta acción no se puede deshacer</li>
                            <li>Se perderá toda la configuración de la moneda</li>
                        </ul>
                        
                        <div class="alert alert-danger small">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            <strong>Advertencia:</strong> Una vez eliminada, no se podrá recuperar esta moneda.
                        </div>
                    {% else %}
                        <h6 class="text-warning">Deshabilitación Temporal</h6>
                        <ul class="small">
                            <li>La moneda se marcará como inactiva</li>
                            <li>Se conservará su historial completo</li>
                            <li>No estará disponible para nuevas operaciones</li>
                            <li>Podrá reactivarse en el futuro</li>
                        </ul>
                        
                        <div class="alert alert-info small">
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>Nota:</strong> Puede reactivar esta moneda en cualquier momento desde la lista de monedas.
                        </div>
                    {% endif %}


                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}